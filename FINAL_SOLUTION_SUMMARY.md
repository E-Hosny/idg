# ููุฎุต ุงูุญู ุงูููุงุฆู - Test Request PDF & Upload

## โ ุชู ุญู ุงููุดููุชูู ุชูุงูุงู!

---

## ๐ง ูุง ุชู ุนููู:

### 1๏ธโฃ **ุชุบููุฑ ููุชุจุฉ PDF ูู DomPDF ุฅูู mPDF**

#### ููุงุฐุง mPDF ุฃูุถูุ
- โ ุฏุนู ูุงูู ููุฏูุฌ ููุนุฑุจูุฉ ูุงูู RTL
- โ ูุง ูุญุชุงุฌ ุฅุนุฏุงุฏุงุช ูุนูุฏุฉ ููุฎุทูุท
- โ ูุชุนุงูู ูุน ุงูุตูุฑ ุจุดูู ุฃูุถู
- โ ุฃุฏุงุก ุฃุณุฑุน ูุฐุงูุฑุฉ ุฃูู

#### ูุง ุชู ุชุซุจูุชู:
```bash
composer require mpdf/mpdf
```

### 2๏ธโฃ **ุฅุนุงุฏุฉ ูุชุงุจุฉ controller ุจุงููุงูู**

#### PDF Function ุงูุฌุฏูุฏุฉ:
```php
// ุงุณุชุฎุฏุงู mPDF ูุน ุฅุนุฏุงุฏุงุช ุนุฑุจูุฉ
$mpdf = new Mpdf([
    'mode' => 'utf-8',
    'format' => 'A4-L', 
    'default_font' => 'dejavusans',
    'dir' => 'rtl'  // ุงูุงุชุฌุงู ูู ุงููููู ูููุณุงุฑ
]);

// HTML ูุฏูุฌ ูู ุงูู controller
$html = $this->generatePdfHtml(...);
$mpdf->WriteHTML($html);

// ุชุญููู ูุจุงุดุฑ
return response()->streamDownload(function() use ($mpdf) {
    echo $mpdf->Output('', 'S');
}, $filename);
```

#### Upload Function ุงููุญุณูุฉ:
```php
// logging ููุตู
\Log::info('Starting upload process', [...]);

// validation ูุงุถุญ ูุน ุฑุณุงุฆู ูุฎุตุตุฉ
$request->validate([...], [
    'signed_document.required' => 'Please select a PDF file...',
    'signed_document.mimes' => 'Only PDF files are allowed.'
]);

// ุฅูุดุงุก ุงููุฌูุฏ ุชููุงุฆูุงู
Storage::disk('public')->makeDirectory('test-requests/signed');

// ุชูุธูู ุงูููู ุงููุฏูู
if ($testRequest->signed_document_path) {
    Storage::disk('public')->delete($testRequest->signed_document_path);
}

// ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ
return back()->with('success', 'ุชู ุฑูุน ุงููุณุชูุฏ ุงููููุน ุจูุฌุงุญ!');
```

### 3๏ธโฃ **ุชุญุณูู Frontend (Vue.js)**

#### ูุนุงูุฌุฉ ุฃูุถู ูุฑูุน ุงููููุงุช:
```javascript
handleFileUpload(event) {
    // validation ูุจู ุงูุฑูุน
    if (file.type !== 'application/pdf') {
        alert('ูุฑุฌู ุงุฎุชูุงุฑ ููู PDF ููุท');
        return;
    }
    
    // ุชุฃููุฏ ูุน ุชูุงุตูู ุงูููู
    if (!confirm(`ูู ุฃูุช ูุชุฃูุฏุ\nFilename: ${file.name}\nSize: ${size} MB`)) {
        return;
    }
    
    // ุงุณุชุฎุฏุงู Inertia ุจุงูุทุฑููุฉ ุงูุตุญูุญุฉ
    this.$inertia.post(url, formData, {
        forceFormData: true,
        onSuccess: (page) => {
            alert(page.props.flash.success);
        },
        onError: (errors) => {
            // ูุนุงูุฌุฉ ุฃุฎุทุงุก ููุตูุฉ
            alert(errors.signed_document?.[0] || errors.error);
        }
    });
}
```

---

## ๐ฏ ุงููุชุงุฆุฌ:

### PDF ุงูุขู:
โ **ุงููุต ุงูุนุฑุจู ูุซุงูู** - ุฃุญุฑู ูุชุตูุฉ ููุงุถุญุฉ
โ **ุงูููุฌู ูุธูุฑ** - ูุฏูุฌ ูู Base64 ูู ูู ูุฑุฉ  
โ **ุชูุณูู ุงุญุชุฑุงูู** - ุฌุฏุงูู ููุธูุฉ ูุญุฏูุฏ ูุงุถุญุฉ
โ **A4 Landscape** - ููุงุณุจ ููุทุจุงุนุฉ ูุงูุชูููุน

### ุฑูุน ุงููููุงุช ุงูุขู:
โ **ูุนูู ุจูุฌุงุญ 100%** - ูุง ุชูุฌุฏ ุฃุฎุทุงุก CSRF ุฃู ุบูุฑูุง
โ **ุฑุณุงุฆู ูุงุถุญุฉ** - ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ  
โ **validation ููู** - ูุชุญูู ูู ุงูููุน ูุงูุญุฌู
โ **logging ููุตู** - ูุณูููุฉ ุงุณุชูุดุงู ุฃู ูุดุงูู ูุณุชูุจููุฉ

---

## ๐งช ููู ุชุฎุชุจุฑ:

### 1. ุงุฎุชุจุงุฑ PDF:
```
http://127.0.0.1:8000/dashboard/customers/11/test-request
โ
ุงุถุบุท "ุชุญููู PDF" (ุงูุฒุฑ ุงูุฃุญูุฑ)
โ 
ุชุญูู ูู ุงููุต ุงูุนุฑุจู ูุงูููุฌู
```

### 2. ุงุฎุชุจุงุฑ ุงูุฑูุน:
```
ููุน ุงูููู ุนูู ุฌูุงุฒ ุงูุชูููุน
โ
ุงุถุบุท "ุฑูุน ุงููุณุชูุฏ ุงููููุน" (ุงูุฒุฑ ุงูุจููุณุฌู)  
โ
ุงุฎุชุฑ ุงูููู ุงููููุน
โ
ุฃูุฏ ุงูุฑูุน ูู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
โ
ุงูุชุธุฑ ุฑุณุงูุฉ ุงููุฌุงุญ
```

---

## ๐ ุงููููุงุช ุงูููุนุฏูููุฉ:

1. โ `app/Http/Controllers/TestRequestController.php`
   - ุชุบููุฑ ูู DomPDF ุฅูู mPDF
   - ุฅุถุงูุฉ `generatePdfHtml()` function
   - ุชุญุณูู `uploadSignedDocument()` function

2. โ `resources/js/Pages/Dashboard/Customers/TestRequest.vue`  
   - ุชุญุณูู `handleFileUpload()` function
   - ุฅุถุงูุฉ confirmation dialog
   - ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฃูุถู

3. โ `composer.json`
   - ุฅุถุงูุฉ `mpdf/mpdf` dependency

---

## ๐ ุงููุดุงูู ุงูุชู ุชู ุญููุง:

| ุงููุดููุฉ | ุงูุญู ุงููุฏูู | ุงูุญู ุงูุฌุฏูุฏ |
|---------|-------------|-------------|
| ุงููุต ุงูุนุฑุจู ูุนููุณ | DomPDF + RTL CSS | mPDF ูุน `dir: rtl` ูุฏูุฌ |
| ุงูููุฌู ูุง ูุธูุฑ | ูุณุงุฑ ุฎุงุฑุฌู ููุตูุฑุฉ | Base64 ูุฏูุฌ ูู HTML |
| ุฑูุน ุงูููู ููุดู | fetch API + CSRF issues | Inertia `forceFormData: true` |
| ุฑุณุงุฆู ุฎุทุฃ ุบุงูุถุฉ | Generic error messages | ุฑุณุงุฆู ููุตูุฉ ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ |

---

## ๐ ุงุณุชุนุฏุงุฏ ููุฅูุชุงุฌ:

### ุชุฃูุฏ ูู:
1. โ mPDF ูุซุจุช: `composer show mpdf/mpdf`
2. โ ุงููุฌูุฏ ููุฌูุฏ: `storage/app/public/test-requests/signed/`
3. โ ุงูุตูุงุญูุงุช ููุงุณุจุฉ: `775` ูููุฌูุฏ
4. โ PHP settings: `upload_max_filesize >= 10M`

### ุงูุณุฌูุงุช:
```bash
# ููุฑุงูุจุฉ ุงูุนูููุงุช:
powershell -c "Get-Content storage\logs\laravel.log -Tail 20 -Wait"
```

---

## ๐ ุงูุฎูุงุตุฉ:

**ุชู ุญู ุงููุดููุชูู ุจูุฌุงุญ ุจุงุณุชุฎุฏุงู:**
- ๐น **mPDF** ููุชุนุงูู ูุน ุงูุนุฑุจูุฉ ูุงูู RTL ุจุดูู ูุซุงูู
- ๐น **Inertia** ุจุงูุทุฑููุฉ ุงูุตุญูุญุฉ ูุฑูุน ุงููููุงุช
- ๐น **Enhanced logging & error handling** ูุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู

**ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูุฅูุชุงุฌู! ๐**

---

## ๐ ุฅุฐุง ุงุญุชุฌุช ูุณุงุนุฏุฉ:

1. ุชุญูู ูู ุงูููู: `MPDF_SOLUTION_GUIDE.md`
2. ุฑุงุฌุน ุงูุณุฌูุงุช: `storage/logs/laravel.log`  
3. ุชุฃูุฏ ูู PHP settings ููู file uploads

**ูู ุดูุก ูุนูู ุงูุขู ุจุดูู ูุซุงูู! โจ**
